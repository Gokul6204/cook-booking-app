{% extends 'core/base.html' %}
{% block title %}Find Cooks - Cook Booking Platform{% endblock %}
{% block content %}
<h2 class="section-title">Find Cooks</h2>
<form method="get" class="form filter-form" id="filterForm">
  <div class="filters">
    <input type="text" name="q" placeholder="Search by name or dish" value="{{ filters.q }}">
    <input type="text" name="location" placeholder="Location" value="{{ filters.location }}">
    <select name="cuisine">
      <option value="">Any Cuisine</option>
      {% for c in cuisines %}
        <option value="{{ c }}" {% if filters.cuisine == c %}selected{% endif %}>{{ c }}</option>
      {% endfor %}
    </select>
    <input type="number" step="0.01" name="min_rate" placeholder="Min $/hr" value="{{ filters.min_rate }}">
    <input type="number" step="0.01" name="max_rate" placeholder="Max $/hr" value="{{ filters.max_rate }}">
    <input type="number" min="0" max="5" name="min_rating" placeholder="Min Rating" value="{{ filters.min_rating }}">
    <button class="btn btn-secondary" type="submit">Apply</button>
  </div>
  <ul class="errors" id="filterErrors"></ul>
</form>

<div class="grid">
  {% for p in cooks %}
  <div class="card">
    <div class="card-body">
      <h3>{{ p.user.get_full_name|default:p.user.username }}</h3>
      <p><span class="badge">{{ p.cuisine }}</span> â€¢ {{ p.location }}</p>
      <p class="price">${{ p.hourly_rate }} / hr</p>
      <p class="rating">Rating: {{ p.average_rating|floatformat:1 }}/5</p>
      <a class="btn btn-secondary" href="{% url 'cook_profile' p.user.id %}">View Profile</a>
    </div>
  </div>
  {% empty %}
  <p>No cooks found matching your filters.</p>
  {% endfor %}
</div>
{% endblock %}
{% block scripts %}
<script>
  window.addEventListener('DOMContentLoaded', function(){
    const form = document.getElementById('filterForm');
    form.addEventListener('submit', function(e){
      const list = document.getElementById('filterErrors');
      list.innerHTML = '';
      const minRate = parseFloat(form.min_rate.value || '');
      const maxRate = parseFloat(form.max_rate.value || '');
      const errs = [];
      if(!isNaN(minRate) && !isNaN(maxRate) && minRate > maxRate){
        errs.push('Min rate cannot exceed max rate.');
      }
      const minRating = parseFloat(form.min_rating.value || '');
      if(!isNaN(minRating) && (minRating < 0 || minRating > 5)){
        errs.push('Rating must be between 0 and 5.');
      }
      if(errs.length){
        e.preventDefault();
        errs.forEach(t=>{ const li=document.createElement('li'); li.textContent=t; list.appendChild(li); });
      }
    });
  })
</script>
{% endblock %}

